syntax = "proto3";

package sentence.v1;

import "google/protobuf/timestamp.proto";
import "common/v1/enums.proto";
import "common/v1/types.proto";

option go_package = "github.com/eslsoft/vocnet/api/gen/sentence/v1;sentencev1";

// Core sentence entity (shared across users)
message Sentence {
  int64 id = 1;
  string content = 2;                              // Original sentence text
  string content_norm = 3;                         // Normalized content for searching
  common.v1.Language language = 4;                 // Language of the sentence
  string hash = 5;                                 // Content hash for deduplication
  int32 length = 6;                                // Character length
  int32 token_count = 7;                           // Word/token count (optional)
  string created_source = 8;                       // How sentence was created (manual/import/auto)
  google.protobuf.Timestamp created_at = 9;
}

// User's personal relationship with a sentence
message UserSentence {
  int64 id = 1;
  int64 user_id = 2;
  int64 sentence_id = 3;
  bool is_starred = 4;                             // User bookmark/favorite
  int32 familiarity = 5;                           // Familiarity level (0-5)
  common.v1.ReviewTiming review_timing = 6;        // Review scheduling
  string private_note = 7;                         // User's private note
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
  
  // Read-only sentence details (populated on response)
  Sentence sentence = 20;
}

// Source/origin information for sentences
message Source {
  int64 id = 1;
  int64 user_id = 2;                               // Owner of this source record
  common.v1.SourceType type = 3;                   // Type of source
  string title = 4;                                // Title of book/article/etc
  string author = 5;                               // Author/creator
  string url = 6;                                  // URL if web-based
  string reference = 7;                            // Page number, chapter, etc
  repeated string tags = 8;                        // User-defined tags
  google.protobuf.Timestamp created_at = 9;
}

// Link between sentence and its source
message SentenceSource {
  int64 sentence_id = 1;
  int64 source_id = 2;
  string relation_type = 3;                        // "direct", "derived", etc
  google.protobuf.Timestamp created_at = 4;
}

// Word usage within a sentence (for highlighting and context)
message WordUsage {
  int64 id = 1;
  int64 user_id = 2;
  int64 user_word_id = 3;                          // Reference to user's word
  int64 sentence_id = 4;
  int32 start_offset = 5;                          // Character position start
  int32 end_offset = 6;                            // Character position end
  string original_text = 7;                        // Actual text in sentence
  string normalized_form = 8;                      // Normalized form for matching
  string grammatical_role = 9;                     // Noun, verb, adjective, etc
  string usage_type = 10;                          // "base", "inflected", "compound"
  int32 confidence = 11;                           // Confidence score (0-100)
  string note = 12;                                // User note about this usage
  google.protobuf.Timestamp created_at = 13;
}